<div class="col col-lg-12">
  <div class="panel panel-default mt-4">
    <!-- /.panel-heading -->
    <div class="panel-body">
      <p>
        <b>Leads Management</b>
      </p>
      <form class="mb-3">
        <div class="form-row">
          <div class="form-group col">
            <button (click)="addLead()" class="btn btn-primary">Add New</button>
          </div>
          <div class="form-group col" *ngIf="!isCityManager && !isAgent">
            <select class="form-control" id="selectCity" name="cityId" (change)="onCityChange()" [(ngModel)]="selectedCity" style="width: 200px;">
              <option value="0">Select City</option>
              <option *ngFor="let city of cities" value="{{ city?._id }}">{{ city?.name }}</option>
            </select>
          </div>
        </div>
      </form>
      <h3 *ngIf="loading">Please wait data is loading</h3>
      <table
        datatable 
        [dtOptions]="dtOptions" 
        [dtTrigger]="dtTrigger"
        class="table table-bordered table-hover" 
        style="table-layout:auto;" 
        id="datatableId"
        >
        <thead>
          <tr>
            <th>ID</th>
            <th>Lead Information</th>
            <th>Contact #</th>
            <th>Type</th>
            <th>Assigned To</th>
            <th *ngIf="auth.isAdmin()">Admin Status</th>
            <th>Agent Status</th>
            <th>Operations</th>
          </tr>
        </thead>
        <tbody>
          <tr class="odd gradeX" *ngFor="let l of resultLeads">
            <td>{{ l._id }}</td>
            <td>
              <u class="capital">{{ l.clientName.toLowerCase() }}</u> 
              want to

              <span *ngIf="getInventory(l._id).purpose == 1">
                sell {{ getPropertyType(l._id).type }}</span>
              <span *ngIf="getInventory(l._id).purpose == 2">
                buy {{ getPropertyType(l._id).type }}</span>
              <span *ngIf="getInventory(l._id).purpose == 3">
                rent {{ getPropertyType(l._id).type }}</span>
              
              in

              <span *ngIf="getSubLocation(l._id).sublocation">
                {{ getSubLocation(l._id).sublocation }},
              </span>
              {{ getLocation(l._id).location }}, {{ getCity(l._id).name }}.

              <br>
              <b>Area</b>: {{ getInventory(l._id).area }}

              <span *ngIf="getInventory(l._id).areaUnit == 1">Sq. Feet</span>
              <span *ngIf="getInventory(l._id).areaUnit == 2">Marla</span>
              <span *ngIf="getInventory(l._id).areaUnit == 3">Kanal</span>

              <b>Demand</b>: Rs. {{ getInventory(l._id).demand | number:'1.0-0' }}

              <b class="capital">{{ getPropertyType(l._id).type }} #</b>: {{ getInventory(l._id).propNumber }}
              <b>Street</b>: {{ getInventory(l._id).street }}
              <br>
              <b>Comment</b>: {{ l.cmt }}
            </td>

            <td>{{ l.phoneNumber }}</td>

            <td *ngIf="l.clientType == 1">Owner</td>
            <td *ngIf="l.clientType == 2">Dealer</td>
            <td *ngIf="l.clientType == 3">Buyer</td>

            <td>{{ getUser(l.assignedTo).name }}</td>

            <td *ngIf="auth.isAdmin()">{{ getStatusType(l.leadAdminStatus) }}</td>
            <td>{{ getStatusType(l.leadAgentStatus) }}</td>
            <td>
              <a *ngIf="auth.isAdmin()" (click)="changeStatus(l.leadAdminStatus, l._id)" class="btn btn-sm btn-default">
                <i class="fas fa-exchange-alt" style="font-size:1.2rem"></i>
              </a>
              <a *ngIf="auth.isAgent()" (click)="changeStatus(l.leadAgentStatus, l._id)" class="btn btn-sm btn-default">
                <i class="fas fa-exchange-alt" style="font-size:1.2rem"></i>
              </a>
              <a (click)="editLead(l._id)" class="btn btn-sm btn-default">
                <i class="fas fa-edit" style="font-size:1.2rem"></i>
              </a>
              <br>
              <button (click)="delModal(l._id)" class="btn btn-sm btn-default" data-toggle="modal" data-target="#delModal">
                <i class="fas fa-trash" style="font-size:1.2rem"></i>
              </button>
            </td>
          </tr>

        </tbody>

        <tfoot>
          <tr>
            <th>
              <input id="leadInput21" type="text" placeholder=""style="width: 40px;" />
            </th>
            <th>
              <input id="leadInput21" type="text" placeholder="" />
            </th>
            <th>
              <input id="leadInput21" type="text" placeholder="" />
            </th>
            <th>
              <input id="leadInput21" type="text" placeholder="" />
            </th>
            <th>
              <input id="leadInput21" type="text" placeholder="" />
            </th>
            <th *ngIf="auth.isAdmin()">
              <input id="leadInput21" type="text" placeholder="" />
            </th>
            <th>
              <input id="leadInput21" type="text" placeholder="" />
            </th>
            <th>
              <i class="fa fa-search" style="font-size:1.8rem;"></i>
            </th>
          </tr>
        </tfoot>

      </table>

      <!-- Delete Modal -->
      <div class="modal fade" id="delModal" tabindex="-1" role="dialog" aria-labelledby="delModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Alert!!</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              Are you sure?
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              <button id="deletebtn" (click)="deleteLead()" type="button" class="btn btn-danger" data-dismiss="modal">Yes, delete it</button>
            </div>
          </div>
        </div>
      </div>

    </div>
    <!-- /.panel-body -->
  </div>
  <!-- /.panel -->
</div>
<!-- /.col-lg-12 -->